<div class="chat-wrapper" id="chat-wrapper">
    <div class="chat-header" id="chat-header">Your virtual assistant <i class="fa-regular fa-circle-xmark close-icon"></i></div>
    <div class="allcont">
        <div id="chat-container"></div>
        <form id="chat-form">
            <input type="text" autocomplete="off"  id="user-input" placeholder="Type your message...">
            <button type="submit" id="submit-btn"><i class="fa-regular fa-paper-plane"></i></button>
        </form>
    </div>
</div>

<button id="chat-toggle"><img id="bot-gif" src="static/assets/img/bonne4.gif" alt="Medical Bot Waving Hand"></button>

<style>
   
   .close-icon {
    padding-left: 150PX; /* Pushes the icon to the far right */
    cursor: pointer; /* Changes cursor to a pointer on hover */
}

.chat-wrapper {
    position: fixed;
    bottom: 20px;
    right: 20px;
    max-width: 400px;
    width: 100%;
    border-radius: 8px;
    
    display: none; /* Initially hidden */
    background-color: transparent; /* Ensure background is set */
}

.chat-header {
    font-family:Cursive ;
    background-color: #3AAFA9;
background-image: #3AAFA9 ;
    color: #fff;
    padding: 10px;
    cursor: pointer;
    text-align: center;
    border-radius: 8px 8px 0 0;
}

.allcont {
    background-color: #fff;
    border-radius: 0 0 8px 8px;
    overflow: hidden;
}

#chat-container {
    background-color:  rgb(237, 241, 241);
 background-blend-mode: screen;    height: 400px;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #7fd8e1;
    border-top: none;
}

.message-wrapper {
    display: flex;
    align-items: center;
    margin: 5px 0;
}

.message-wrapper.user {
    justify-content: flex-end;
}

.message-wrapper.bot {
    justify-content: flex-start;
}

.message {
    margin: 5px;
    padding: 10px;
    border-radius: 10px;
    max-width: 70%;
    display: inline-block;
    background-color: #f4f4f4; /* Set default background */
}

.user .message {
    background-color: #2d9e9e; 
    border-radius: 20PX;       color: white;
}

.bot .message {
    background-color: rgb(30, 57, 121); 
    border-radius: 20PX; 
    color: white;
}

.icon {
    margin-right: 10px;
}

.user .icon {
    margin-left: 10px;
    margin-right: 0;
}

#chat-form {
    display: flex;
    padding: 0px;
    border-top: 1px solid #ccc;
    background-color: #3AAFA9;
}

#user-input {
    border-radius: 300px;
    margin:10px;
    flex: 1;
    padding: 10px;
    border: 1px solid #ccc;
 
}

#submit-btn {


    padding: 10px;
    margin: 5px;
    background-color: transparent;
    color: #fff;
    border: none;
    cursor: pointer;
}

#chat-toggle {
    position: fixed;
    bottom: 20px;
    right: 100px;
    padding: 10px 20px;
    width: 100px;
    height: 100px;
    background-color: transparent;

    font-size: 20px;
    font-weight: bold; /* Make the text bold */
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

#bot-gif {
    position: fixed;
 padding: 7px;
    bottom: 20px;
    right: 20px; /* Adjust as needed */
    width: 150px;
    height: 100px;
    border-radius: 10%;
   background-color:  rgba(255, 255, 255, 0.523) ;

}
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const chatWrapper = document.getElementById('chat-wrapper');
        const chatToggle = document.getElementById('chat-toggle');
        const chatHeader = document.getElementById('chat-header');
        const chatContainer = document.getElementById('chat-container');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');

        chatToggle.addEventListener('click', function() {
            chatWrapper.style.display = chatWrapper.style.display === 'block' ? 'none' : 'block';
            chatToggle.style.display = chatWrapper.style.display === 'block' ? 'none' : 'block';
        });

        chatHeader.addEventListener('click', function() {
            chatWrapper.style.display = 'none';
            chatToggle.style.display = 'block';
        });

        function addMessage(role, content) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `message-wrapper ${role}`;

            const icon = document.createElement('i');
            icon.className = role === 'user' ? 'fas fa-user icon' : 'fas fa-robot icon';

            const message = document.createElement('p');
            message.textContent = content;
            message.className = `message ${role}`;

            messageWrapper.appendChild(icon);
            messageWrapper.appendChild(message);
            chatContainer.appendChild(messageWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Add default greeting message
        addMessage('bot', 'Welcome to the Bone Fracture Information Bot! Iâ€™m here to assist you with any questions you might have about bone fractures.');

        chatForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const userMessage = userInput.value.trim();
            if (userMessage === '') return;
            addMessage('user', userMessage);
            userInput.value = '';

            fetch('/ask', {
                method: 'POST',
                body: new URLSearchParams({ question: userMessage }),
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.answer) {
                    addMessage('bot', data.answer);
                } else {
                    addMessage('bot', 'Error: ' + (data.error || 'No valid response from OpenAI'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                addMessage('bot', 'Error: Unable to reach the server.');
            });
        });
    });
</script>
